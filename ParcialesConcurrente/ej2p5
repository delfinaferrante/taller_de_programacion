programa p5ej2
procesos
  proceso esperarMensajes(E id:numero)
  variables
    aux:numero
  comenzar
    si(id = 1)
      EnviarMensaje(1, r2)
      EnviarMensaje(1, r3)
      RecibirMensaje(aux, r2)
      RecibirMensaje(aux, r3)
    sino
      si(id = 2)
        EnviarMensaje(2, r1)
        EnviarMensaje(2, r3)
        RecibirMensaje(aux, r1)
        RecibirMensaje(aux, r3)
      sino
        EnviarMensaje(3, r1)
        EnviarMensaje(3, r2)      
        RecibirMensaje(aux, r1)
        RecibirMensaje(aux, r2)  
  fin
  proceso depositoFlores(ES flores:numero; E av:numero; E ca:numero)
  comenzar
    BloquearEsquina(50,50)
    Pos(50,50)
    mientras(flores > 0)
      depositarFlor
      flores:= flores - 1
    Pos(av,ca)
    LiberarEsquina(50,50)
  fin
  proceso juntarFlores(ES flores:numero)
  comenzar
    mientras(HayFlorEnLaEsquina)
      tomarFlor
      flores:= flores + 1
  fin
areas
  ciudad: AreaC (1,1,100,100)
robots
  robot recolectores
  variables
    flores,av,ca,id:numero
  comenzar
    RecibirMensaje(id, jefe)
    flores:= 0
    derecha     
    ca:= PosCa
    mientras(PosAv < 100)
      repetir 10
        si(PosAv < 100)
          juntarFlores(flores)
          mover
      av:= PosAv
      depositoFlores(flores,av,ca)
      esperarMensajes(id)
    EnviarMensaje(0,jefe)
  fin
  robot fiscalizador
  variables
    valor,flores:numero
  comenzar
    EnviarMensaje(1,r1)
    EnviarMensaje(2,r2)
    EnviarMensaje(3,r3)
    flores:= 0
    repetir 3
      RecibirMensaje(valor, *)
    BloquearEsquina(50,50)
    Pos(50,50)   
    juntarFlores(flores)
    Informar(flores) 
  fin
variables
  r1,r2,r3: recolectores
  jefe: fiscalizador
comenzar
  AsignarArea(r1, ciudad)
  AsignarArea(r2, ciudad)
  AsignarArea(r3, ciudad)
  AsignarArea(jefe, ciudad)
  Iniciar(r1, 1,1)
  Iniciar(r2, 1,2)
  Iniciar(r3, 1,3)
  Iniciar(jefe, 1,4)
fin